---
icon: ðŸ‰
title: (Korean) Monorepo and Lerna
date: 2017-03-09
tags: [lerna, npm, yarn]
category: legacy
---

ì œê°€ ë§Œë“  [Remark Math](https://github.com/Rokt33r/remark-math)ë¥¼ ë°°í¬í•˜ë©´ì„œ ëª¨ë…¸ë¦¬í¬ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ [Lerna]ë¥¼ ì‚¬ìš©í•œ ë…¸í•˜ìš°ë¥¼ ê³µìœ í•©ë‹ˆë‹¤.

# ìš©ì–´ ì„¤ëª…

## ëª¨ë…¸ë¦¬í¬(Monorepo)?

ê°€ë ¹ ë°”ë²¨ê³¼ ê°™ì´ ë³µìˆ˜ì˜ íŒ¨í‚¤ì§€ê°€ ì„œë¡œ ì—°ê³„ë˜ì„œ í™œìš©ë˜ëŠ” íŒ¨í‚¤ì§€ì˜ ê²½ìš°, ê°ê°ì˜ ë¦¬í¬ì§€í„°ë¦¬ë¡œ ë§Œë“¤ë©´ ê´€ë¦¬í•˜ê¸°ê°€ ë§¤ìš° ë³µìž¡í•´ì§‘ë‹ˆë‹¤. ì•„ë§ˆë„ íŒ¨í‚¤ì§€ê°„ì˜ ì´ìŠˆë¥¼ ì²˜ë¦¬í•  ë•Œ ë§¤ë²ˆ ë¦¬í¬ì§€í„°ë¦¬ë¥¼ ê±´ë„ˆë‹¤ë‹ˆë©´ì„œ í™•ì¸ì„ í•´ì•¼í•˜ê³  ë§¤ë²ˆ ë²ˆê±°ë¡­ê²Œ ë”°ë¡œë”°ë¡œ ë°°í¬í•´ì•¼í•˜ê² ì£ ...

ì´ë¥¼ ìœ„í•œ ëŒ€ì±…ì¤‘ í•˜ë‚˜ê°€ ëª¨ë…¸ë¦¬í¬ì¸ë°, í•˜ë‚˜ì˜ ë¦¬í¬ì§€í„°ë¦¬ì— ë³µìˆ˜ì˜ íŒ¨í‚¤ì§€ë¥¼ ë‘ëŠ” í˜•ì‹ìž…ë‹ˆë‹¤. ë¦¬ì•¡íŠ¸ì™€ ë°”ë²¨ì—ì„œ ì£¼ë¡œ í™œìš©ë˜ê³  ìžˆê³ , Remark Mathì˜ ê²½ìš°ë„ ìˆ˜ì‹ íŒŒì„œ í™•ìž¥ê³¼ ë Œë”ëŸ¬ í”ŒëŸ¬ê·¸ì¸ì„ ì‰½ê²Œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ í•˜ë‚˜ì˜ ëª¨ë…¸ë¦¬í¬ë¡œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

> [Why is Babel a monorepo?](https://github.com/babel/babel/blob/master/doc/design/monorepo.md) - Babel

## [Lerna]?

ëª¨ë…¸ë¦¬í¬ë¥¼ ê°„íŽ¸í•˜ê²Œ ê´€ë¦¬í•  ìˆ˜ ìžˆë„ë¡ ë„ì™€ì£¼ëŠ” CLI íŒ¨í‚¤ì§€ìž…ë‹ˆë‹¤.

Gitì˜ ì»¤ë°‹ìƒíƒœë¥¼ í™•ì¸í•˜ì—¬ ë³€ê²½ëœ íŒ¨í‚¤ì§€ë§Œ ì¼ê´„ì ìœ¼ë¡œ NPMìœ¼ë¡œ ë°°í¬í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ê³  ë™ì‹œì— ë¦¬ëª¨íŠ¸ ë¦¬í¬ì§€í„°ë¦¬ê¹Œì§€ í‘¸ì‹œí•´ì¤ë‹ˆë‹¤. ì•„ì§ ë² íƒ€ë²„ì ¼ì´ê¸´í•´ë„ ë§¤ìš°ë§¤ìš° íŽ¸ë¦¬í–ˆì–´ìš”. :100::100:

# ì‚¬ìš©ë²•

## `lerna init`

ìš°ì„ , Gitì˜ ë³€ê²½ì ì„ í†µí•´ íŒ¨í‚¤ì§€ë¥¼ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì— Gitì´ ì´ˆê¸°í™” ë˜ì–´ì ¸ì•¼í•©ë‹ˆë‹¤.

```
git init
```

ê·¸ë¦¬ê³ , Lernaë¥¼ ê¸€ë¡œë²Œë¡œ ì„¤ì¹˜ì™€ í•¨ê»˜ ì´ˆê¸°í™”ë¥¼ í•©ë‹ˆë‹¤.

```
npm i -g lerna
lerna init -i
```

`-i` í”Œëž˜ê·¸ëŠ” `--independent`ì˜ ì–¼ë¼ì´ì–´ìŠ¤ë¡œ, ê°ê°ì˜ íŒ¨í‚¤ì§€ì˜ ë²„ì ¼ì„ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê² ë‹¤ëŠ” ì˜ë¯¸ìž…ë‹ˆë‹¤. ì—†ì´ ê¸°ë³¸ìƒíƒœë¡œ ì´ˆê¸°í™”ë¥¼ ì‹œí‚¤ë©´ í•˜ë‚˜ì˜ ë²„ì ¼ìœ¼ë¡œ ëª¨ë‘ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.

Babel ì—­ì‹œ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.

ì´ˆê¸°í™”ë¥¼ ë§ˆì¹˜ë©´ `lerna.json`ì´ ìƒì„±ë©ë‹ˆë‹¤.

```json
{
  "lerna": "2.0.0-beta.38",
  "packages": ["packages/*"],
  "version": "independent"
}
```

`lerna`ëŠ” ì‚¬ìš©ì¤‘ì¸ Lernaì˜ ë²„ì ¼ì´ì—ìš”. Lernaê°€ ì•„ì§ ë² íƒ€ì´ì–´ì„œ ì„¤ì •ì´ ì–¸ì œ ë°”ë€”ì§€ ëª¨ë¥´ê¸°ì— ì‚¬ìš©í•˜ëŠ” CLIì™€ ì„¤ì •ì˜ ë²„ì ¼ì´ í•­ìƒ ë™ì¼í•  ê²ƒì„ ìš”êµ¬í•˜ê³  ìžˆì–´ìš”.

`packages`ëŠ” ê°ê°ì˜ íŒ¨í‚¤ì§€ë“¤ì˜ ìœ„ì¹˜ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

`version`ì€ `-i` í”Œëž˜ê·¸ë¥¼ ë„£ì—ˆê¸° ë•Œë¬¸ì— `independent`ë¡œ ì„¤ì •ë˜ì–´ ìžˆìŠµë‹ˆë‹¤. í”Œëž˜ê·¸ê°€ ì—†ìœ¼ë©´ ê·¸ëƒ¥ ë²„ì ¼ì´ ë“¤ì–´ê°€ìš”.

ì´ì œ ê°ê°ì˜ íŒ¨í‚¤ì§€ëŠ” `packages/some-package`í˜•ì‹ìœ¼ë¡œ ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤. ë˜í•œ, ê°ê°ì˜ íŒ¨í‚¤ì§€ë§ˆë‹¤ `package.json`ì„ ìƒì„±í•´ì£¼ì…”ì•¼ í•´ìš”!

## `lerna bootstrap`

`npm install`ì„ ê°ê°ì˜ íŒ¨í‚¤ì§€ì— ëŒ€í•´ ì¼ê´„ì ìœ¼ë¡œ ëŒë ¤ì¤ë‹ˆë‹¤.

ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì˜ `package.json`ì— `postinstall`ë¡œ ì¶”ê°€í•´ë‘ë©´ ê°„íŽ¸í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìžˆì–´ìš”.

```
{
  "scripts": {
    "postinstall": "lerna bootstrap"
  }
}
```

## `lerna publish`

`npm publish`ë¥¼ ì¼ê´„ì ìœ¼ë¡œ ì‹¤í–‰í•´ ì¤ë‹ˆë‹¤. ì»¤ë°‹ì„ í™•ì¸í•´ì„œ ì—…ë°ì´íŠ¸ê°€ ëœ íŒ¨í‚¤ì§€ë§Œ ë°°í¬ë¥¼ ì‹œë„í•©ë‹ˆë‹¤.

ê°œì¸ì ìœ¼ë¡œ íŽ¸ë¦¬í–ˆë˜ê±´ ëŒ€í™”í˜•ì‹ìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ ë²„ì ¼ì„ ì˜¬ë¦´ ìˆ˜ ìžˆì—ˆë˜ ê²ƒì´ì—ˆì–´ìš”.

```
? Select a new version for remark-math (currently 0.2.0) (Use arrow keys)
â¯ Patch (0.2.1)
  Minor (0.3.0)
  Major (1.0.0)
  Custom
```

ê·¸ë¦¬ê³  ì•ˆì „í•˜ê²Œ ë”ë¸”ì²´í¬ê¹Œì§€ í•´ì¤ë‹ˆë‹¤.

```
Changes:
- rehype-katex: 0.2.0 => 0.2.1
- remark-html-katex: 0.2.0 => 0.2.1
- remark-math: 0.2.0 => 0.2.1

? Are you sure you want to publish the above changes?
```

ì™„ë£Œí•˜ë©´ ë²„ì ¼ë¶€ë¶„ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ì»¤ë°‹ê³¼ íŒ¨í‚¤ì§€ë³„ë¡œ íƒœê·¸ë¥¼ ìƒì„±í•˜ê³  ë“±ë¡ëœ ë¦¬í¬ì§€í„°ë¦¬ë¡œ í‘¸ì‹œê¹Œì§€ í•´ì¤˜ìš”. ì •ë§ íŽ¸ë¦¬í•´ìš”! :smile:

# íŒ & ì£¼ì˜ì‚¬í•­

## ê°ê°ì˜ íŒ¨í‚¤ì§€ì˜ `package.json`ì—ì„œ `devDependencies`ì™€ `scripts`ëŠ” í•„ìš”ì—†ë‹¤?

ë³µìˆ˜ì˜ íŒ¨í‚¤ì§€ë¥¼ ê´€ë¦¬í•˜ê¸° ì‰½ê²Œí•˜ê¸°ìœ„í•´ ë§Œë“¤ì—ˆê¸° ë•Œë¬¸ì— ê°œë°œí™˜ê²½ ì—­ì‹œ í†µí•©ì‹œí‚¤ëŠ”ê²Œ ê´€ë¦¬í•˜ê¸° íŽ¸í•˜ë‹¤ê³  ìƒê°í•´ìš”. ë¬¼ë¡  ì¼ê´„ì ìœ¼ë¡œ `npm`ëª…ë ¹ì„ ì‹¤í–‰ì‹œí‚¤ëŠ” ì»¤ë§¨ë“œê°€ ìžˆê¸°ëŠ” í•´ìš”. ëŒ€ì‹ , ê°ê°ì˜ íŒ¨í‚¤ì§€ë³„ë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ê´€ë¦¬í•˜ëŠ”ê±´ ì–´ì©Œë©´ ëª¨ë…¸ë¦¬í¬ë¥¼ ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ëŠ” ì¼€ì´ìŠ¤ì´ì§€ ì•Šì„ê¹Œ ì‹¶ì–´ìš”.

ê³ ë¡œ, ì €ì˜ ê²½ìš° ê°œë°œì— í•„ìš”í•œ ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ë“¤ì€ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì˜ [`package.json`](https://github.com/Rokt33r/remark-math/blob/master/package.json)ì— ë„£ì–´ ë‘ì—ˆìŠµë‹ˆë‹¤.

## ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì˜ `package.json`ì—ì„  `dependencies`ì™€ `version`ê°€ í•„ìš”ì—†ë‹¤?

ë£¨íŠ¸ë””ë ‰í† ë¦¬ëŠ” í¼ë¸”ë¦¬ì‹œë¥¼ í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„ì´ê¸° ë•Œë¬¸ì—, `dependencies`ê°€ í•„ìš” ì—†ìŠµë‹ˆë‹¤.

ê·¸ë¦¬ê³ , `version`ì„ ë¯¸ë¦¬ ì§€ì›Œë‘ëŠ” ê²ƒë„ ìƒë‹¹ížˆ ì¢‹ì€ ë²„ë¦‡ì´ë¼ê³  ìƒê°í•´ìš”. ì‹¤ìˆ˜ë¡œ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì—ì„œ `npm publish` ëª…ë ¹ì„ ì‹¤í–‰í•´ë²„ë ¤ë„ `version`ì´ ì¡´ìž¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë°°í¬ê°€ ì›ì²œì ìœ¼ë¡œ ë¶ˆê°€ëŠ¥ í•˜ê²Œ ë©ë‹ˆë‹¤.

## ë°°í¬ì‹œ íƒœê¹…ê³¼ TravisCI

ì—„ë°€í•˜ê²Œ ë§í•˜ë©´ TravisCIê°€ ë‚˜ìœê±´ë°.... ë°°í¬ì‹œ íŒ¨í‚¤ì§€ë³„ë¡œ íƒœê¹…ì„ í•˜ê¸° ë•Œë¬¸ì— TravisCIê°€ íƒœê·¸ë³„ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ë°˜ë³µí•´ì„œ ëŒë ¤ìš”..ðŸ˜£ ðŸ˜£ (ë¶„ëª… ì»¤ë°‹ì˜ í•´ì‹œê°€ ì¼ì¹˜í•¨ì—ë„ ë¶ˆêµ¬í•œë°ë„ ë§ì´ì£ ...)

![Travis tag handling](/assets/images/travisci-tag-handling.png)

ì¼ë‹¨ì€ ëŒ€ì²˜ë²•ì€ ë‹¤ìŒê³¼ ê°™ì´ í”Œëž˜ê·¸ë¥¼ ì¶”ê°€ì‹œí‚¤ëŠ” 2ê°€ì§€ ë°©ë²•ì´ ìžˆë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.

- `--skip-git` : ì´ ê²½ìš° ê¹ƒì˜ ì¡°ìž‘ì—†ì´ ë°°í¬ë¥¼ í•©ë‹ˆë‹¤. ë²„ì „ ë³€ê²½í›„ ì§ì ‘ ì»¤ë°‹/í‘¸ì‹œë¥¼ í•´ì£¼ì…”ì•¼í•©ë‹ˆë‹¤.
- `-m "[ci skip]"` : ì»¤ë°‹ë©”ì„¸ì§€ë¥¼ ë®ì–´ì¨ì„œ CIë¥¼ ìƒëžµì‹œí‚µë‹ˆë‹¤.

## npmjs.comì—ì„œì˜ readme.md í‘œì‹œ

`npmjs.com`ëŠ” ë£¨íŠ¸ ë””ë ‰í† ë¦¬ `package.json`ì˜ `name`ê³¼ ë™ì¼í•œ ì´ë¦„ì˜ íŒ¨í‚¤ì§€ì— í•œí•´ì„œ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì˜ `readme.md`ë¥¼ í•´ë‹¹ íŒ¨í‚¤ì§€ì˜ ë¬¸ì„œë¡œ ê°€ì ¸ì™€ìš”. ê³ ë¡œ, ë‹¤ë¥¸ íŒ¨í‚¤ì§€ë“¤ì€ ë‹¤ ë”°ë¡œë”°ë¡œ `readme.md`ë¥¼ ë§Œë“¤ì–´ ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. ë¬¼ë¡ , ë™ì¼í•œ ì´ë¦„ì˜ íŒ¨í‚¤ì§€ì—ë„ `readme.md`ë¥¼ ë§Œë“¤ì–´ ì£¼ë©´ ë£¨íŠ¸ë””ë ‰í† ë¦¬ê°€ ì•„ë‹ˆë¼ íŒ¨í‚¤ì§€ìª½ ë¬¸ì„œë¥¼ ìš°ì„ í•´ì„œ í‘œì‹œí•©ë‹ˆë‹¤.

ë§ì´ ë³µìž¡í•˜ë‹ˆ Remark Mathì˜ ê²½ìš°ë¥¼ ë³´ì—¬ë“œë¦´ê²Œìš”.

```sh
/readme.md # remark-mathì˜ ë¬¸ì„œ
/packages/remark-html-katex/readme.md # remark-html-katexì˜ ë¬¸ì„œ
/packages/rehype-katex/readme.md # rehype-katexì˜ ë¬¸ì„œ
```

ë§Œì•½ì— `packages/remark-math/readme.md`ë¥¼ ì¶”ê°€í•œ ê²½ìš° ì´ë ‡ê²Œ ë°”ë€ë‹ˆë‹¤.

```sh
/readme.md # npmjs.comì—ì„œëŠ” í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤!
/packages/remark-math/readme.md # remark-mathì˜ ë¬¸ì„œ
/packages/remark-html-katex/readme.md # remark-html-katexì˜ ë¬¸ì„œ
/packages/rehype-katex/readme.md # rehype-katexì˜ ë¬¸ì„œ
```

## `npm` ëŒ€ì‹  `yarn`

[`2.0.0-beta.38`](https://github.com/lerna/lerna/releases/tag/v2.0.0-beta.38) ë²„ì ¼ ë¶€í„° `lerna.json`ì— ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •ì„ í•˜ë©´ ì“¸ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

```json
  "npmClient": "yarn"
```

> `yarn.lock`ì€ `.gitignore`ì— ì¶”ê°€í•˜ëŠ” ê±¸ë¡œ ê°ì¶œ ìˆ˜ ìžˆëŠ” ë“¯ í•©ë‹ˆë‹¤.
>
> ```
> packages/*/yarn.lock
> ```
